<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Keeper of the Realms</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; padding:0; font-family:Consolas, monospace; background:#111; color:#eee; display:flex; flex-direction:column; height:100vh; }
    #log { flex:1; overflow-y:auto; padding:1em; border-bottom:1px solid #333; }
    #inputRow { display:flex; }
    #inputBox { flex:1; padding:1em; font-size:1em; border:none; background:#222; color:#fff; }
    #sendBtn { padding:1em; background:#3498db; color:#fff; border:none; font-weight:bold; }
  </style>
</head>
<body>

<div id="log">🧙 Keeper of the Realms awaits...</div>
<div id="inputRow">
  <input id="inputBox" placeholder="Type your action..." />
  <button id="sendBtn">Send</button>
</div>

<script>
  const log = document.getElementById("log");
  const input = document.getElementById("inputBox");
  const send = document.getElementById("sendBtn");

  // Prompt once for your API key
  let KEY = localStorage.getItem("openai_key");
  if (!KEY) {
    KEY = prompt("Enter your OpenAI API key:");
    localStorage.setItem("openai_key", KEY);
  }

  let history = [
    { role: "system", content: "You are the Game Master in a fantasy RPG. Narrate responses like a Dungeon Master." }
  ];

  function append(msg, role = "🤖") {
    const div = document.createElement("div");
    div.innerHTML = `<b>${role}</b>: ${msg}`;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
  }

  async function askGPT(text) {
    append(text, "🧑‍🎮");
    input.value = "";
    history.push({ role: "user", content: text });
    append("*thinking...*");
    
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: history
      })
    });

    const data = await res.json();
    const reply = data.choices[0].message.content;
    log.lastChild.remove();
    append(reply);
    history.push({ role: "assistant", content: reply });
  }

  function sendInput() {
    const text = input.value.trim();
    if (text) askGPT(text);
  }

  send.onclick = sendInput;
  input.addEventListener("keydown", e => {
    if (e.key === "Enter") sendInput();
  });
</script>

</body>
</html>